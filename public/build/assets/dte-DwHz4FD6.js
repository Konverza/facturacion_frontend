import{s as n}from"./alert-Cg1FgE4f.js";$(document).ready(function(){let f;function p(){f=setInterval(()=>{const t=new Date,a=String(t.getHours()).padStart(2,"0"),e=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");$("#time-in-real-time").val(`${a}:${e}:${o}`)},1e3)}p(),$(document).on("change","#dte-otra-fecha",function(){this.checked?Swal.fire({title:"¿Desea cambiar la fecha y hora del DTE?",text:"Tome en cuenta que enviar una fecha distinta a la actual puede ser observado por el Ministerio de Hacienda, ¿Desea continuar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Cambiar",cancelButtonText:"No"}).then(t=>{t.isConfirmed?clearInterval(f):$("#dte-otra-fecha").prop("checked",!1)}):p()});const v=$("#count_product"),h=$("#price");$("#count_product, #price").on("input",function(){const t=parseFloat(v.val()),a=parseFloat(h.val());if(v.val()===""||h.val()===""){$("#iva").text("$0.00"),$("#turismo").text("$0.00"),$("#add-valorem-bebidas-alcoholicas").text("$0.00"),$("#add-valorem-tabaco-cigarrillos").text("$0.00"),$("#add-valorem-tabaco-cigarros").text("$0.00"),$("#total_product").val(0);return}var e=t*a;const o=parseFloat($("#descuento_product").val())||0;if(e=e-o,e<0){$("#descuento_product").val(0),$("#total_product").val(s(parseFloat(t*a),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_product").val(s(e,8)),$("#descuento_product").prop("max",s(e,8)),_(a,t)}),$("#descuento_product").on("input",function(){const t=parseFloat($(this).val())||0,a=parseFloat($(this).prop("max"))||0;if(a===0){n("error","Error","Debes ingresar un precio y cantidad"),$(this).val("");return}if(t>a){n("error","Error","El descuento no puede ser mayor al total"),$(this).val("");return}const e=a-t;$("#total_product").val(s(e,8))}),$("#count_product, #valor_unitario, #depreciacion").on("input",function(){const t=parseFloat($("#count_product").val())||0,a=parseFloat($("#valor_unitario").val())||0,e=parseFloat($("#depreciacion").val())||0,o=t*a-e;$("#valor_donado").val(s(o,8))});function _(t,a){const e=a*(t/1.13)*.13,o=a*(t/1.13)*.05,r=a*(t/1.13)*.08,d=a*(t/1.13)*.39,l=a*(t/1.13)*1;$("#iva").text("$"+s(e,2)),$("#turismo").text("$"+s(o,2)),$("#add-valorem-bebidas-alcoholicas").text("$"+s(r,2)),$("#add-valorem-tabaco-cigarrillos").text("$"+s(d,2)),$("#add-valorem-tabaco-cigarros").text("$"+s(l,2))}$(".tax-toggle").on("change",function(){const t=$($(this).data("list"));$(this).is(":checked")?t.removeClass("hidden"):t.addClass("hidden")}),$(document).on("click",".selected-customer",function(){const t=$(this).data("url");$("#selected-customer").addClass("hidden").removeClass("flex"),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios.get(t).then(a=>{const e=a.data;$("#numero_documento_customer").val(e.customer.numDocumento??""),$("#nit-receptor").val(e.customer.numDocumento??"").trigger("input"),$("#nombre_customer").val(e.customer.nombre),$("#nombre_comercial_customer").val(e.customer.nombreComercial),$("#actividad_economica_customer").val(e.customer.actividadEconomica),$("#complemento_customer").val(e.customer.complemento),$("#correo_customer").val(e.customer.correo),$("#telefono_customer").val(e.customer.telefono),$("#nrc_customer").val(e.customer.nrc),$("#select-tipos-documentos").html(e.select_tipos_documentos),$("#select-actividad-economica").html(e.select_actividad_economica),$("#select-departamentos").html(e.select_departamentos),$("#select-municipio").html(e.select_municipios),$("#select-pais").html(e.select_countries),$("#select-tipo-persona").html(e.select_tipo_persona)}).catch(a=>{console.error("Error al obtener el cliente:",a)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("click",".btn-selected-product",function(){const t=$(this).closest("form"),a=t.attr("action"),e=t.attr("method"),o=t.serialize();$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),$("#form-add-product").trigger("reset"),axios({method:e,url:a,data:o}).then(r=>{const d=r.data;if(d.success===!1){n("error","Error","Producto no encontrado");return}$("#product_id").val(d.product.id),$("#product_description").val(d.product.descripcion),d.product.has_stock?$("#count").prop("max",d.product.stockActual):$("#count").removeAttr("max");let l=d.product.precioSinTributos,i=d.product.precioUni;d.customer&&d.customer.special_price&&(l=d.product.special_price,i=d.product.special_price_with_iva);const u=d.dte!="01"?l:i;$("#product_price").val(u),$("#container-data-product").removeClass("hidden")}).catch(r=>{console.error("Error al obtener el producto:",r)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$("#count").on("input",function(){const t=$(this).val(),a=$("#product_price").val(),e=parseFloat($(this).prop("max")),o=parseFloat($("#descuento_total").val())||0,r=s(parseFloat(t)*parseFloat(a)-o,8);if(t>e){n("error","Error","La cantidad no puede ser mayor al stock disponible"),$(this).val(""),$("#total_item").val("");return}if(r<0){$("#descuento_total").val(0),$("#total_item").val(parseFloat(t)*s(parseFloat(a),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(r),$("#descuento_total").prop("max",r)}),$("#descuento_total").on("input",function(){const t=parseFloat($(this).val())||0,a=parseFloat($("#descuento_total").prop("max"))||0;if(a===0){n("error","Error","Debes ingresar una cantidad y precio"),$(this).val("");return}if((t===""||t===0)&&$("#total_item").val($("#product_price").val()*$("#count").val()),t>a){n("error","Error","El descuento no puede ser mayor al total"),$(this).val(""),$("#total_item").val(s(a,8));return}const e=a-t;if(e<0){$("#total_item").val(0),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(s(e,8))}),$("#btn-add-product").click(function(){const t=$(this).closest("form");let a=!1;const e=$("#count"),o=$("#error-"+e.attr("id")),r=$("#type-sale"),d=$("#error-"+r.attr("id")),l=$("#total_item"),i=$("#error-"+l.attr("id"));if(e.val().trim()===""?(e.focus().addClass("is-invalid"),o.css("display","flex"),a=!0):(e.removeClass("is-invalid"),o.css("display","none")),r.length>0&&(r.val().trim()===""?(r.next().find(".selected").addClass("is-invalid"),d.css("display","flex"),a=!0):(r.next().find(".selected").removeClass("is-invalid"),d.css("display","none"))),l.val().trim()===""?(l.focus().addClass("is-invalid"),i.css("display","flex"),a=!0):(l.removeClass("is-invalid"),i.css("display","none")),a){n("error","Error","Rellena los campos requeridos");return}$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios({method:t.attr("method"),url:t.attr("action"),data:t.serialize()}).then(u=>{const m=u.data;console.log(m),m.success?($("#table-products-dte").html(m.table_products),$("#table-exportacion").html(m.table_exportacion),$("#container-data-product").addClass("hidden"),t.trigger("reset"),n("success","Agregado","Producto agregado correctamente"),m.monto_pendiente!==void 0&&$("#monto_total").val(s(m.monto_pendiente,2))):n("error","Error",m.message)}).catch(u=>{console.error("Error al agregar producto:",u)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("change",".retener",function(){const t=$(this).data("action");var a="inactive";const e=$(this).data("type");$(this).is(":checked")?a="active":a="inactive",axios.get(t,{params:{value:a,type:e}}).then(function(o){$("#table-products-dte").html(o.data.table_products),o.data.monto_pendiente!==void 0&&$("#monto_total").val(s(o.data.monto_pendiente,2))}).catch(function(o){console.log(o)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#documento_asociado").on("Changed",function(){const t=$(this).val(),a=$("#container-data-documento-asociado"),e=$("#container-data-transporte"),o=$("#container-data-medico");switch(t){case"1":case"2":a.removeClass("hidden"),a.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required"),o.addClass("hidden"),o.find("input").removeAttr("required");break;case"3":a.addClass("hidden"),a.find("input").removeAttr("required"),o.removeClass("hidden"),o.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required");break;case"4":a.addClass("hidden"),a.find("input").removeAttr("required"),e.removeClass("hidden"),e.find("input").attr("required",!0),o.addClass("hidden"),o.find("input").removeAttr("required");break}}),$("#condicion_operacion").on("Changed",function(){const t=$(this).val();console.log(t),t==="1"&&($("#input-plazo").addClass("hidden"),$("#input-periodo").addClass("hidden")),t==="2"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden")),t==="3"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden"))}),$("#tipo_item_exportar").on("Changed",function(){const t=$(this).val(),a=$("#container-data-exportacion");t==="1"||t==="3"?a.removeClass("hidden"):(a.addClass("hidden"),a.find("input").val(""))});function c(t,a){return a=a||t.val(),a===""?(t.addClass("is-invalid"),!1):(t.removeClass("is-invalid"),!0)}$("#btn-add-forma-pago").on("click",function(){const t=$(this).data("action"),a=$("#condicion_operacion").val(),e=$("#forma_pago"),o=$("#monto_total"),r=$("#numero_documento"),d=$("#plazo"),l=$("#periodo");var i=!0;if(a==="1"&&(c(e.next().find(".selected"),e.val())||(i=!1),c(o)||(i=!1),c(r)||(i=!1)),a==="2"&&(c(o)||(i=!1),c(r)||(i=!1),c(d.next().find(".selected"),d.val())||(i=!1),c(l)||(i=!1)),a==="3"&&(c(e.next().find(".selected"),e.val())||(i=!1),c(o)||(i=!1),c(r)||(i=!1),c(d.next().find(".selected"),d.val())||(i=!1),c(l)||(i=!1)),!i){n("error","Error","Rellena los campos requeridos");return}i&&(axios.post(t,{forma_pago:e.val(),monto:o.val(),numero_documento:r.val(),plazo:d.val(),periodo:l.val(),_token:$("input[name='_token']").val()}).then(function(u){u.data.success?($("#table-formas-pago").html(u.data.table_data),$("#monto_total").val(u.data.monto_pendiente),n("success","Exito","Forma de pago agregada correctamente")):n("error","Error",u.data.message)}).catch(function(u){console.log(u)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"))}),$("#monto_sujeto_retencion").on("input",function(){const t=$(this).val();$("#codigo_tributo").val()==="22"&&$("#iva_retenido").val(s(t*.01,2))}),$("#codigo_tributo").on("Changed",function(){if($(this).val()==="Retención IVA"){var a=$("#monto_sujeto_retencion").val();$("#iva_retenido").val(s(a*.01,2))}}),$(".new-item").on("click",function(){const t=$(this).data("action"),a=$(this).data("type");axios.get(t).then(function(e){if(e.data.success)a==="new-product"?($("#drawer-new-product").removeClass("-translate-x-full"),$("#overlay").removeClass("hidden"),$("body").addClass("overflow-hidden")):a==="selected-product"?($("#selected-product").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")):a==="other-contribution"&&($("#taxes-iva").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden"));else{n("warning","Advertencia","Para agregar items, primero debe ingresar los documentos relacionados");return}}).catch(function(e){console.log(e)})}),$(document).on("click",".submit-form",function(){const t=$(this).closest("form");console.log(t);let a=!0;if(t.find("[required]").each(function(){const e=$(this),o=$("#error-"+e.attr("id"));e.val().trim()?(e.removeClass("is-invalid"),o.css("display","none"),a=!0):(e.addClass("is-invalid"),o.css("display","flex"),a=!1),e.is("[select]")&&!e.val().trim()&&e.next().find(".selected").addClass("is-invalid")}),!a){n("error","Error","Rellena los campos requeridos");return}axios({method:t.attr("method"),url:t.attr("action"),data:t.serialize()}).then(function(e){const o=e.data;o.success?(n("success","Exito",o.message),t.trigger("reset"),$("#table-"+o.table).html(o.table_data),o.modal!==void 0?$("#"+o.modal).addClass("hidden").removeClass("flex"):o.drawer!==void 0&&($("#"+o.drawer).addClass("-translate-x-full"),$("#overlay").addClass("hidden")),o.monto_pendiente!==void 0&&$("#monto_total").val(s(o.monto_pendiente,2)),o.table_selected_product!==void 0&&$("#table-selected-product").html(o.table_selected_product),o.table_exportacion!==void 0&&$("#table-exportacion").html(o.table_exportacion),o.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(o.table_sujeto_excluido),o.select_data&&$("."+o.select).html(o.select_data),o.select_data_new&&$("."+o.select_new).html(o.select_data_new),o.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(o.total_iva_retenido_texto),o.total_discounts!==void 0&&$("#container-total-discount").html(o.total_discounts)):n("error","Error",o.message)}).catch(function(e){console.log(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".delete-discounts",function(){const t=$(this).data("action");axios.get(t).then(function(a){const e=a.data;e.success?($("#table-"+e.table).html(e.table_data),e.monto_pendiente!==void 0&&$("#monto_total").val(s(e.monto_pendiente,2)),e.total_discounts!==void 0&&$("#container-total-discount").html(e.total_discounts),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido)):n("error","Error",e.message)}).catch(function(a){console.log(a)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-delete",function(){const t=$(this).data("action");axios.get(t).then(function(a){const e=a.data;e.success?(n("success","Exito",e.message),e.table_data&&$("#table-"+e.table).html(e.table_data),e.table_data_2&&$("#table-"+e.table_2).html(e.table_data_2),e.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(e.total_iva_retenido_texto),e.table_exportacion!==void 0&&$("#table-exportacion").html(e.table_exportacion),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido),e.select_data&&$("."+e.select).html(e.select_data),e.select_data_new&&$("."+e.select_new).html(e.select_data_new),e.monto_pendiente!==void 0&&$("#monto_total").val(s(e.monto_pendiente,2))):n("error","Error",e.message)}).catch(function(a){console.log(a)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#omitir_datos_receptor").on("change",function(){$(this).is(":checked")?($("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").val(""),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!0),$("#datos-receptor select, #datos-receptor input").prop("required",!1),$("#datos-receptor").addClass("hidden")):($("#datos-receptor input, #datos-receptor select").prop("required",!0),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!1),$("#datos-receptor").removeClass("hidden"))}),$("#container-total-discount input").on("input",function(){$("#container-total-discount input").each(function(){parseFloat($(this).val())>100&&($(this).val(100),n("error","Error","El descuento no puede ser mayor al 100%"))})}),$(document).on("change","#seguro, #flete",function(){const t=$(this).data("url"),a=$(this).data("type"),e=$(this).val();axios.get(t,{params:{value:e,type:a}}).then(o=>{const r=o.data;r.success?(n("success","Éxito",r.message),r.monto_pendiente!==void 0&&$("#monto_total").val(s(r.monto_pendiente,2)),$("#table-exportacion").html(r.table_exportacion)):($("#flete").val(""),$("#seguro").val(""),n("error","Error",r.message))}).catch(o=>{console.error(o)})}),$(document).on("click",".btn-selected-document-electric",function(){const t=$(this).data("url"),a=$(this).data("cod");axios.get(t,{params:{codGeneracion:a}}).then(e=>{const o=e.data;o.success?(console.log("Documento seleccionado:",o),$("#table-"+o.table).html(o.table_data),$("#"+o.modal).addClass("hidden").removeClass("flex"),$("."+o.select).html(o.select_data),$("."+o.select_new).html(o.select_data_new),$("#overlay").addClass("hidden"),$("body").removeClass("overflow-hidden"),n("success","Exito",o.message)):n("error","Error",o.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-add-document-electric",function(){if($("#numero_documento_customer").val()===""){n("error","Error","Debes seleccionar un cliente antes de agregar un documento electrónico");return}$("#add-documento-electronico").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-selected-document",function(){const t=$(this).data("cod"),a=$(this).data("url");axios.get(a,{params:{codGeneracion:t}}).then(e=>{const o=e.data;o.success?($("#container-data-document").removeClass("hidden"),$("#monto-documento").val(o.monto),$("#cod-generacion").val(t),$("#codigo-tributo-2").val()==="22"&&$("#iva-retenido-documento").val(s(o.monto*.01,2))):n("error","Error",o.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#sucursal_select").on("Changed",function(){const t=$(this).data("action"),a=$(this).val(),e=$(this).data("business-id");$("#datos-sucursal").addClass("hidden"),$.ajax({url:t,type:"GET",data:{sucursal_id:a,business_id:e},success:function(o){$("#punto_venta_select").html(o.html),$("#datos-sucursal #complemento_emisor").val(o.sucursal.complemento),$("#datos-sucursal #correo_emisor").val(o.sucursal.correo),$("#datos-sucursal #telefono_emisor").val(o.sucursal.telefono),$("#datos-sucursal").removeClass("hidden")},error:function(){console.error("Error al cambiar la sucursal")}})});function s(t,a=2){const e=Math.pow(10,a);return Math.round((t+Number.EPSILON)*e)/e}});
