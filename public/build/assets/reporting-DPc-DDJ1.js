document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("drop-zone"),d=document.getElementById("file-input"),h=document.getElementById("browse-files");document.getElementById("drop-content");const r=document.getElementById("files-list"),c=document.getElementById("files-container"),l=document.getElementById("selected-documents");let o=[],i=0;["dragenter","dragover","dragleave","drop"].forEach(e=>{n.addEventListener(e,u,!1),document.body.addEventListener(e,u,!1)});function u(e){e.preventDefault(),e.stopPropagation()}n.addEventListener("dragenter",function(e){i++,i===1&&(document.getElementById("drop-title").textContent="Soltar archivos",n.classList.add("drag-zone-active"))}),n.addEventListener("dragleave",function(e){i--,i===0&&(document.getElementById("drop-title").textContent="Arrastra y suelta tus archivos aquí",n.classList.remove("drag-zone-active"))}),n.addEventListener("dragover",function(e){}),n.addEventListener("drop",f,!1);function f(e){const t=e.dataTransfer.files;document.getElementById("drop-title").textContent="Arrastra y suelta tus archivos aquí",i=0,m(t)}h.addEventListener("click",()=>{d.click()}),n.addEventListener("click",function(){d.click()}),d.addEventListener("change",e=>{m(e.target.files)});function m(e){o=[...e],p()}function p(){if(o.length===0){r.classList.add("hidden"),d.value="",l.classList.add("hidden");return}r.classList.remove("hidden"),l.classList.remove("hidden"),c.innerHTML="",o.forEach((e,a)=>{const t=g(e,a);c.appendChild(t)})}function g(e,a){const t=document.createElement("div");t.className="flex items-center justify-between p-3 bg-secondary-50 dark:bg-secondary-900/50 rounded-lg border border-secondary-200 dark:border-secondary-700",e.name.split(".").pop().toLowerCase();const s=(e.size/1024).toFixed(1)+" KB";return t.innerHTML=`
                    <div class="flex items-center gap-3">
                        <div class="p-2 rounded-lg bg-white dark:bg-secondary-800">
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="size-5 dark:text-white text-secondary-800 icon icon-tabler icons-tabler-outline icon-tabler-file-code"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 13l-1 2l1 2" /><path d="M14 13l1 2l-1 2" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-secondary-900 dark:text-white">${e.name}</p>
                            <p class="text-xs text-secondary-500 dark:text-secondary-400">${s}</p>
                        </div>
                    </div>
                    <button type="button" onclick="removeFile(${a})" class="p-1 rounded-lg text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="size-4 icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                    </button>
                `,t}window.removeFile=function(e){o.splice(e,1),d.value="",p()},window.getSelectedFiles=function(){return o},$("#form-generate-book").submit(function(e){b(),$("#text-loader").text("Generando libro de ventas..."),setTimeout(()=>{$("#loader").addClass("hidden")},2e3)});function b(){if($('input[name="uploaded_files[]"]').remove(),o.length>0){const e=document.getElementById("form-generate-book");o.forEach((a,t)=>{const s=document.createElement("input");s.type="file",s.name="uploaded_files[]",s.style.display="none";const v=new DataTransfer;v.items.add(a),s.files=v.files,e.appendChild(s)})}}$("#book-type").on("Changed",function(){const e=$(this).val();switch($(".container-books").addClass("hidden"),$(".container-anexos").addClass("hidden"),e){case"anexos_f07":$("#container-tipo-anexo").removeClass("hidden");break;case"contribuyentes":$("#container-ventas-contribuyentes").removeClass("hidden");break;case"consumidores":$("#container-ventas-consumidor-final").removeClass("hidden");break;case"retencion_iva":$("#container-retencion-iva").removeClass("hidden");break;case"compras":$("#container-compras").removeClass("hidden");break;case"percepcion_iva":$("#container-percepcion-iva").removeClass("hidden");break}}),$("#anexo-type").on("Changed",function(){const e=$(this).val();switch($(".container-anexos").addClass("hidden"),e){case"contribuyentes":case"consumidores":$("#container-tipo-operacion-ingreso").removeClass("hidden");break;case"compras":case"compras_se":$("#container-tipo-operacion-egreso").removeClass("hidden");break}}),$("#only-selected").on("change",function(){$("#only-mix").prop("checked",!1)}),$("#only-mix").on("change",function(){$("#only-selected").prop("checked",!1)})});
