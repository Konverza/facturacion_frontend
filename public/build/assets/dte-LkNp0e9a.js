import{s as n}from"./alert-Cg1FgE4f.js";$(document).ready(function(){let f;function p(){f=setInterval(()=>{const a=new Date,o=String(a.getHours()).padStart(2,"0"),e=String(a.getMinutes()).padStart(2,"0"),t=String(a.getSeconds()).padStart(2,"0");$("#time-in-real-time").val(`${o}:${e}:${t}`)},1e3)}p(),$(document).on("change","#dte-otra-fecha",function(){this.checked?Swal.fire({title:"¿Desea cambiar la fecha y hora del DTE?",text:"Tome en cuenta que enviar una fecha distinta a la actual puede ser observado por el Ministerio de Hacienda, ¿Desea continuar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Cambiar",cancelButtonText:"No"}).then(a=>{a.isConfirmed?clearInterval(f):$("#dte-otra-fecha").prop("checked",!1)}):p()});const v=$("#count_product"),h=$("#price");$("#count_product, #price").on("input",function(){const a=parseFloat(v.val()),o=parseFloat(h.val());if(v.val()===""||h.val()===""){$("#iva").text("$0.00"),$("#turismo").text("$0.00"),$("#add-valorem-bebidas-alcoholicas").text("$0.00"),$("#add-valorem-tabaco-cigarrillos").text("$0.00"),$("#add-valorem-tabaco-cigarros").text("$0.00"),$("#total_product").val(0);return}var e=a*o;const t=parseFloat($("#descuento_product").val())||0;if(e=e-t,e<0){$("#descuento_product").val(0),$("#total_product").val(d(parseFloat(a*o),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_product").val(d(e,8)),$("#descuento_product").prop("max",d(e,8)),_(o,a)}),$("#descuento_product").on("input",function(){const a=parseFloat($(this).val())||0,o=parseFloat($(this).prop("max"))||0;if(o===0){n("error","Error","Debes ingresar un precio y cantidad"),$(this).val("");return}if(a>o){n("error","Error","El descuento no puede ser mayor al total"),$(this).val("");return}const e=o-a;$("#total_product").val(d(e,8))}),$("#count_product, #valor_unitario, #depreciacion").on("input",function(){const a=parseFloat($("#count_product").val())||0,o=parseFloat($("#valor_unitario").val())||0,e=parseFloat($("#depreciacion").val())||0,t=a*o-e;$("#valor_donado").val(d(t,8))});function _(a,o){const e=o*(a/1.13)*.13,t=o*(a/1.13)*.05,r=o*(a/1.13)*.08,s=o*(a/1.13)*.39,i=o*(a/1.13)*1;$("#iva").text("$"+d(e,2)),$("#turismo").text("$"+d(t,2)),$("#add-valorem-bebidas-alcoholicas").text("$"+d(r,2)),$("#add-valorem-tabaco-cigarrillos").text("$"+d(s,2)),$("#add-valorem-tabaco-cigarros").text("$"+d(i,2))}$(".tax-toggle").on("change",function(){const a=$($(this).data("list"));$(this).is(":checked")?a.removeClass("hidden"):a.addClass("hidden")}),$(document).on("click",".selected-customer",function(){const a=$(this).data("url");$("#selected-customer").addClass("hidden").removeClass("flex"),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios.get(a).then(o=>{const e=o.data;$("#numero_documento_customer").val(e.customer.numDocumento??""),$("#nit-receptor").val(e.customer.numDocumento??"").trigger("input"),Livewire.dispatch("refreshNumeroDocumento",{nuevoNumeroDocumento:e.customer.numDocumento??""}),$("#nombre_customer").val(e.customer.nombre),$("#nombre_comercial_customer").val(e.customer.nombreComercial),$("#actividad_economica_customer").val(e.customer.actividadEconomica),$("#complemento_customer").val(e.customer.complemento),$("#correo_customer").val(e.customer.correo),$("#telefono_customer").val(e.customer.telefono),$("#nrc_customer").val(e.customer.nrc),$("#select-tipos-documentos").html(e.select_tipos_documentos),$("#select-actividad-economica").html(e.select_actividad_economica),$("#select-departamentos").html(e.select_departamentos),$("#select-municipio").html(e.select_municipios),$("#select-pais").html(e.select_countries),$("#select-tipo-persona").html(e.select_tipo_persona)}).catch(o=>{console.error("Error al obtener el cliente:",o)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("click",".btn-selected-product",function(){const a=$(this).closest("form"),o=a.attr("action"),e=a.attr("method"),t=a.serialize();$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),$("#form-add-product").trigger("reset"),axios({method:e,url:o,data:t}).then(r=>{const s=r.data;if(s.success===!1){n("error","Error","Producto no encontrado");return}$("#product_id").val(s.product.id),$("#product_description").val(s.product.descripcion),s.product.has_stock?$("#count").prop("max",s.product.stockActual):$("#count").removeAttr("max");let i=s.product.precioSinTributos,l=s.product.precioUni;s.customer&&s.customer.special_price&&(i=s.product.special_price,l=s.product.special_price_with_iva);const u=s.dte!="01"?i:l;$("#product_price").val(u),$("#container-data-product").removeClass("hidden")}).catch(r=>{console.error("Error al obtener el producto:",r)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$("#count").on("input",function(){const a=$(this).val(),o=$("#product_price").val(),e=parseFloat($(this).prop("max")),t=parseFloat($("#descuento_total").val())||0,r=d(parseFloat(a)*parseFloat(o)-t,8);if(a>e){n("error","Error","La cantidad no puede ser mayor al stock disponible"),$(this).val(""),$("#total_item").val("");return}if(r<0){$("#descuento_total").val(0),$("#total_item").val(parseFloat(a)*d(parseFloat(o),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(r),$("#descuento_total").prop("max",r)}),$("#descuento_total").on("input",function(){const a=parseFloat($(this).val())||0,o=parseFloat($("#descuento_total").prop("max"))||0;if(o===0){n("error","Error","Debes ingresar una cantidad y precio"),$(this).val("");return}if((a===""||a===0)&&$("#total_item").val($("#product_price").val()*$("#count").val()),a>o){n("error","Error","El descuento no puede ser mayor al total"),$(this).val(""),$("#total_item").val(d(o,8));return}const e=o-a;if(e<0){$("#total_item").val(0),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(d(e,8))}),$("#btn-add-product").click(function(){const a=$(this).closest("form");let o=!1;const e=$("#count"),t=$("#error-"+e.attr("id")),r=$("#type-sale"),s=$("#error-"+r.attr("id")),i=$("#total_item"),l=$("#error-"+i.attr("id"));if(e.val().trim()===""?(e.focus().addClass("is-invalid"),t.css("display","flex"),o=!0):(e.removeClass("is-invalid"),t.css("display","none")),r.length>0&&(r.val().trim()===""?(r.next().find(".selected").addClass("is-invalid"),s.css("display","flex"),o=!0):(r.next().find(".selected").removeClass("is-invalid"),s.css("display","none"))),i.val().trim()===""?(i.focus().addClass("is-invalid"),l.css("display","flex"),o=!0):(i.removeClass("is-invalid"),l.css("display","none")),o){n("error","Error","Rellena los campos requeridos");return}$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios({method:a.attr("method"),url:a.attr("action"),data:a.serialize()}).then(u=>{const m=u.data;console.log(m),m.success?($("#table-products-dte").html(m.table_products),$("#table-exportacion").html(m.table_exportacion),$("#container-data-product").addClass("hidden"),a.trigger("reset"),n("success","Agregado","Producto agregado correctamente"),m.monto_pendiente!==void 0&&$("#monto_total").val(d(m.monto_pendiente,2))):n("error","Error",m.message)}).catch(u=>{console.error("Error al agregar producto:",u)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("change",".retener",function(){const a=$(this).data("action");var o="inactive";const e=$(this).data("type");$(this).is(":checked")?o="active":o="inactive",axios.get(a,{params:{value:o,type:e}}).then(function(t){$("#table-products-dte").html(t.data.table_products),t.data.monto_pendiente!==void 0&&$("#monto_total").val(d(t.data.monto_pendiente,2))}).catch(function(t){console.log(t)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#documento_asociado").on("Changed",function(){const a=$(this).val(),o=$("#container-data-documento-asociado"),e=$("#container-data-transporte"),t=$("#container-data-medico");switch(a){case"1":case"2":o.removeClass("hidden"),o.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required"),t.addClass("hidden"),t.find("input").removeAttr("required");break;case"3":o.addClass("hidden"),o.find("input").removeAttr("required"),t.removeClass("hidden"),t.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required");break;case"4":o.addClass("hidden"),o.find("input").removeAttr("required"),e.removeClass("hidden"),e.find("input").attr("required",!0),t.addClass("hidden"),t.find("input").removeAttr("required");break}}),$("#condicion_operacion").on("Changed",function(){const a=$(this).val();console.log(a),a==="1"&&($("#input-plazo").addClass("hidden"),$("#input-periodo").addClass("hidden")),a==="2"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden")),a==="3"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden"))}),$("#tipo_item_exportar").on("Changed",function(){const a=$(this).val(),o=$("#container-data-exportacion");a==="1"||a==="3"?o.removeClass("hidden"):(o.addClass("hidden"),o.find("input").val(""))});function c(a,o){return o=o||a.val(),o===""?(a.addClass("is-invalid"),!1):(a.removeClass("is-invalid"),!0)}$("#btn-add-forma-pago").on("click",function(){const a=$(this).data("action"),o=$("#condicion_operacion").val(),e=$("#forma_pago"),t=$("#monto_total"),r=$("#numero_documento"),s=$("#plazo"),i=$("#periodo");var l=!0;if(o==="1"&&(c(e.next().find(".selected"),e.val())||(l=!1),c(t)||(l=!1),c(r)||(l=!1)),o==="2"&&(c(t)||(l=!1),c(r)||(l=!1),c(s.next().find(".selected"),s.val())||(l=!1),c(i)||(l=!1)),o==="3"&&(c(e.next().find(".selected"),e.val())||(l=!1),c(t)||(l=!1),c(r)||(l=!1),c(s.next().find(".selected"),s.val())||(l=!1),c(i)||(l=!1)),!l){n("error","Error","Rellena los campos requeridos");return}l&&(axios.post(a,{forma_pago:e.val(),monto:t.val(),numero_documento:r.val(),plazo:s.val(),periodo:i.val(),_token:$("input[name='_token']").val()}).then(function(u){u.data.success?($("#table-formas-pago").html(u.data.table_data),$("#monto_total").val(u.data.monto_pendiente),n("success","Exito","Forma de pago agregada correctamente")):n("error","Error",u.data.message)}).catch(function(u){console.log(u)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"))}),$("#monto_sujeto_retencion").on("input",function(){const a=$(this).val();$("#codigo_tributo").val()==="22"&&$("#iva_retenido").val(d(a*.01,2))}),$("#codigo_tributo").on("Changed",function(){if($(this).val()==="Retención IVA"){var o=$("#monto_sujeto_retencion").val();$("#iva_retenido").val(d(o*.01,2))}}),$(".new-item").on("click",function(){const a=$(this).data("action"),o=$(this).data("type");axios.get(a).then(function(e){if(e.data.success)o==="new-product"?($("#drawer-new-product").removeClass("-translate-x-full"),$("#overlay").removeClass("hidden"),$("body").addClass("overflow-hidden")):o==="selected-product"?($("#selected-product").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")):o==="other-contribution"&&($("#taxes-iva").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden"));else{n("warning","Advertencia","Para agregar items, primero debe ingresar los documentos relacionados");return}}).catch(function(e){console.log(e)})}),$(document).on("click",".submit-form",function(){const a=$(this).closest("form");let o=!0;if(a.find("[required]").each(function(){const e=$(this),t=$("#error-"+e.attr("id"));e.val().trim()?(e.removeClass("is-invalid"),t.css("display","none"),o=!0):(e.addClass("is-invalid"),t.css("display","flex"),o=!1),e.is("[select]")&&!e.val().trim()&&e.next().find(".selected").addClass("is-invalid")}),!o){n("error","Error","Rellena los campos requeridos");return}axios({method:a.attr("method"),url:a.attr("action"),data:a.serialize()}).then(function(e){const t=e.data;t.success?(n("success","Exito",t.message),a.trigger("reset"),$("#table-"+t.table).html(t.table_data),t.modal!==void 0?$("#"+t.modal).addClass("hidden").removeClass("flex"):t.drawer!==void 0&&($("#"+t.drawer).addClass("-translate-x-full"),$("#overlay").addClass("hidden")),t.monto_pendiente!==void 0&&$("#monto_total").val(d(t.monto_pendiente,2)),t.table_selected_product!==void 0&&$("#table-selected-product").html(t.table_selected_product),t.table_exportacion!==void 0&&$("#table-exportacion").html(t.table_exportacion),t.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(t.table_sujeto_excluido),t.select_data&&$("."+t.select).html(t.select_data),t.select_data_new&&$("."+t.select_new).html(t.select_data_new),t.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(t.total_iva_retenido_texto),t.total_discounts!==void 0&&$("#container-total-discount").html(t.total_discounts),t.comprobante_retencion!==void 0&&(t.success?($("#container-data-hacienda").removeClass("hidden"),$("#cod-generacion-hacienda").val(t.data.codGeneracion),$("#tipo-dte-hacienda").val(t.data.tipoDte),$("#fecha-emision-hacienda").val(t.data.fechaEmision),$("#monto-documento-hacienda").val(t.data.sujetoRetencion),$("#iva-retenido-documento-hacienda").val(t.data.ivaRetenido),$("#descripcion-retencion-hacienda").val(t.data.descripcion)):n("error","Error",t.message))):n("error","Error",t.message)}).catch(function(e){console.log(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".delete-discounts",function(){const a=$(this).data("action");axios.get(a).then(function(o){const e=o.data;e.success?($("#table-"+e.table).html(e.table_data),e.monto_pendiente!==void 0&&$("#monto_total").val(d(e.monto_pendiente,2)),e.total_discounts!==void 0&&$("#container-total-discount").html(e.total_discounts),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido)):n("error","Error",e.message)}).catch(function(o){console.log(o)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-delete",function(){const a=$(this).data("action");axios.get(a).then(function(o){const e=o.data;e.success?(n("success","Exito",e.message),e.table_data&&$("#table-"+e.table).html(e.table_data),e.table_data_2&&$("#table-"+e.table_2).html(e.table_data_2),e.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(e.total_iva_retenido_texto),e.table_exportacion!==void 0&&$("#table-exportacion").html(e.table_exportacion),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido),e.select_data&&$("."+e.select).html(e.select_data),e.select_data_new&&$("."+e.select_new).html(e.select_data_new),e.monto_pendiente!==void 0&&$("#monto_total").val(d(e.monto_pendiente,2))):n("error","Error",e.message)}).catch(function(o){console.log(o)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#omitir_datos_receptor, #save_as_template").on("change",function(){$("#save_as_template").is(":checked")?($("#omitir-datos-receptor-container").addClass("hidden"),$("#generate-button").addClass("hidden"),$("#draft-button").addClass("hidden"),$("#template-button").removeClass("hidden"),$("#template_name").removeClass("hidden")):($("#omitir-datos-receptor-container").removeClass("hidden"),$("#generate-button").removeClass("hidden"),$("#draft-button").removeClass("hidden"),$("#template-button").addClass("hidden"),$("#template_name").addClass("hidden")),$(this).is(":checked")?($("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").val(""),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!0),$("#datos-receptor select, #datos-receptor input").prop("required",!1),$("#datos-receptor").addClass("hidden")):($("#datos-receptor input, #datos-receptor select").prop("required",!0),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!1),$("#datos-receptor").removeClass("hidden"))}),$("#container-total-discount input").on("input",function(){$("#container-total-discount input").each(function(){parseFloat($(this).val())>100&&($(this).val(100),n("error","Error","El descuento no puede ser mayor al 100%"))})}),$(document).on("change","#seguro, #flete",function(){const a=$(this).data("url"),o=$(this).data("type"),e=$(this).val();axios.get(a,{params:{value:e,type:o}}).then(t=>{const r=t.data;r.success?(n("success","Éxito",r.message),r.monto_pendiente!==void 0&&$("#monto_total").val(d(r.monto_pendiente,2)),$("#table-exportacion").html(r.table_exportacion)):($("#flete").val(""),$("#seguro").val(""),n("error","Error",r.message))}).catch(t=>{console.error(t)})}),$(document).on("click",".btn-selected-document-electric",function(){const a=$(this).data("url"),o=$(this).data("cod");axios.get(a,{params:{codGeneracion:o}}).then(e=>{const t=e.data;t.success?(console.log("Documento seleccionado:",t),$("#table-"+t.table).html(t.table_data),$("#"+t.modal).addClass("hidden").removeClass("flex"),$("."+t.select).html(t.select_data),$("."+t.select_new).html(t.select_data_new),$("#overlay").addClass("hidden"),$("body").removeClass("overflow-hidden"),n("success","Exito",t.message)):n("error","Error",t.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-add-document-electric",function(){if($("#numero_documento_customer").val()===""){n("error","Error","Debes seleccionar un cliente antes de agregar un documento electrónico");return}$("#add-documento-electronico").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-selected-document",function(){const a=$(this).data("cod"),o=$(this).data("url");axios.get(o,{params:{codGeneracion:a}}).then(e=>{const t=e.data;t.success?($("#container-data-document").removeClass("hidden"),$("#monto-documento").val(t.monto),$("#cod-generacion").val(a),$("#codigo-tributo-2").val()==="22"&&$("#iva-retenido-documento").val(d(t.monto*.01,2))):n("error","Error",t.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("submit","#form-query-dte",function(a){a.preventDefault();const o=$(this),e=o.attr("action"),t=o.attr("method"),r=o.serialize();$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios({method:t,url:e,data:r}).then(s=>{const i=s.data;i.success?($("#container-data-hacienda").removeClass("hidden"),$("#cod-generacion-hacienda").val(i.codGeneracion),$("#monto-documento-hacienda").val(i.sujetoRetencion),$("#iva-retenido-documento-hacienda").val(i.ivaRetenido),$("#descripcion-retencion-hacienda").val(i.descripcion),n("success","Éxito","Consulta realizada correctamente")):n("error","Error",i.message)}).catch(s=>{console.error("Error al realizar la consulta:",s)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$("#sucursal_select").on("Changed",function(){const a=$(this).data("action"),o=$(this).val(),e=$(this).data("business-id");$("#datos-sucursal").addClass("hidden"),$.ajax({url:a,type:"GET",data:{sucursal_id:o,business_id:e},success:function(t){$("#punto_venta_select").html(t.html),$("#datos-sucursal #complemento_emisor").val(t.sucursal.complemento),$("#datos-sucursal #correo_emisor").val(t.sucursal.correo),$("#datos-sucursal #telefono_emisor").val(t.sucursal.telefono),$("#datos-sucursal").removeClass("hidden")},error:function(){console.error("Error al cambiar la sucursal")}})});function d(a,o=2){const e=Math.pow(10,o);return Math.round((a+Number.EPSILON)*e)/e}});
