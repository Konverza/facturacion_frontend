document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("drop-zone"),s=document.getElementById("file-input"),p=document.getElementById("browse-files");document.getElementById("drop-content");const a=document.getElementById("files-list"),l=document.getElementById("files-container"),c=document.getElementById("selected-documents");let o=[],r=0;["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,u,!1),document.body.addEventListener(e,u,!1)});function u(e){e.preventDefault(),e.stopPropagation()}t.addEventListener("dragenter",function(e){r++,r===1&&(document.getElementById("drop-title").textContent="Soltar archivos",t.classList.add("drag-zone-active"))}),t.addEventListener("dragleave",function(e){r--,r===0&&(document.getElementById("drop-title").textContent="Arrastra y suelta tus archivos aquí",t.classList.remove("drag-zone-active"))}),t.addEventListener("dragover",function(e){}),t.addEventListener("drop",h,!1);function h(e){const n=e.dataTransfer.files;document.getElementById("drop-title").textContent="Arrastra y suelta tus archivos aquí",r=0,f(n)}p.addEventListener("click",()=>{s.click()}),t.addEventListener("click",function(){s.click()}),s.addEventListener("change",e=>{f(e.target.files)});function f(e){o=[...e],m()}function m(){if(o.length===0){a.classList.add("hidden"),s.value="",c.classList.add("hidden");return}a.classList.remove("hidden"),c.classList.remove("hidden"),l.innerHTML="",o.forEach((e,i)=>{const n=g(e,i);l.appendChild(n)})}function g(e,i){const n=document.createElement("div");n.className="flex items-center justify-between p-3 bg-secondary-50 dark:bg-secondary-900/50 rounded-lg border border-secondary-200 dark:border-secondary-700",e.name.split(".").pop().toLowerCase();const d=(e.size/1024).toFixed(1)+" KB";return n.innerHTML=`
                    <div class="flex items-center gap-3">
                        <div class="p-2 rounded-lg bg-white dark:bg-secondary-800">
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="size-5 dark:text-white text-secondary-800 icon icon-tabler icons-tabler-outline icon-tabler-file-code"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M10 13l-1 2l1 2" /><path d="M14 13l1 2l-1 2" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-secondary-900 dark:text-white">${e.name}</p>
                            <p class="text-xs text-secondary-500 dark:text-secondary-400">${d}</p>
                        </div>
                    </div>
                    <button type="button" onclick="removeFile(${i})" class="p-1 rounded-lg text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors">
                        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="size-4 icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>
                    </button>
                `,n}window.removeFile=function(e){o.splice(e,1),s.value="",m()},window.getSelectedFiles=function(){return o},$("#form-generate-book").submit(function(e){y(),$("#text-loader").text("Generando libro de ventas..."),setTimeout(()=>{$("#loader").addClass("hidden")},2e3)});function y(){if($('input[name="uploaded_files[]"]').remove(),o.length>0){const e=document.getElementById("form-generate-book");o.forEach((i,n)=>{const d=document.createElement("input");d.type="file",d.name="uploaded_files[]",d.style.display="none";const v=new DataTransfer;v.items.add(i),d.files=v.files,e.appendChild(d)})}}$("#book-type").on("Changed",function(){const e=$(this).val();$(".container-books").addClass("hidden"),e==="contribuyentes"?$("#container-ventas-contribuyentes").removeClass("hidden"):e==="consumidores"?$("#container-ventas-consumidor-final").removeClass("hidden"):e==="retencion_iva"?$("#container-retencion-iva").removeClass("hidden"):e==="compras"?$("#container-compras").removeClass("hidden"):e==="percepcion_iva"&&$("#container-percepcion-iva").removeClass("hidden")}),$("#only-selected").on("change",function(){$("#only-mix").prop("checked",!1)}),$("#only-mix").on("change",function(){$("#only-selected").prop("checked",!1)})});
