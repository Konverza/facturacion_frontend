import{s as n}from"./alert-Cg1FgE4f.js";$(document).ready(function(){let f;function p(){f=setInterval(()=>{const t=new Date,o=String(t.getHours()).padStart(2,"0"),e=String(t.getMinutes()).padStart(2,"0"),a=String(t.getSeconds()).padStart(2,"0");$("#time-in-real-time").val(`${o}:${e}:${a}`)},1e3)}p(),$(document).on("change","#dte-otra-fecha",function(){this.checked?Swal.fire({title:"¿Desea cambiar la fecha y hora del DTE?",text:"Tome en cuenta que enviar una fecha distinta a la actual puede ser observado por el Ministerio de Hacienda, ¿Desea continuar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Sí, Cambiar",cancelButtonText:"No"}).then(t=>{t.isConfirmed?clearInterval(f):$("#dte-otra-fecha").prop("checked",!1)}):p()});const v=$("#count_product"),h=$("#price");$("#count_product, #price").on("input",function(){const t=parseFloat(v.val()),o=parseFloat(h.val());if(v.val()===""||h.val()===""){$("#iva").text("$0.00"),$("#turismo").text("$0.00"),$("#add-valorem-bebidas-alcoholicas").text("$0.00"),$("#add-valorem-tabaco-cigarrillos").text("$0.00"),$("#add-valorem-tabaco-cigarros").text("$0.00"),$("#total_product").val(0);return}var e=t*o;const a=parseFloat($("#descuento_product").val())||0;if(e=e-a,e<0){$("#descuento_product").val(0),$("#total_product").val(d(parseFloat(t*o),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_product").val(d(e,8)),$("#descuento_product").prop("max",d(e,8)),_(o,t)}),$("#descuento_product").on("input",function(){const t=parseFloat($(this).val())||0,o=parseFloat($(this).prop("max"))||0;if(o===0){n("error","Error","Debes ingresar un precio y cantidad"),$(this).val("");return}if(t>o){n("error","Error","El descuento no puede ser mayor al total"),$(this).val("");return}const e=o-t;$("#total_product").val(d(e,8))});function _(t,o){const e=o*(t/1.13)*.13,a=o*(t/1.13)*.05,r=o*(t/1.13)*.08,s=o*(t/1.13)*.39,l=o*(t/1.13)*1;$("#iva").text("$"+d(e,2)),$("#turismo").text("$"+d(a,2)),$("#add-valorem-bebidas-alcoholicas").text("$"+d(r,2)),$("#add-valorem-tabaco-cigarrillos").text("$"+d(s,2)),$("#add-valorem-tabaco-cigarros").text("$"+d(l,2))}$(".tax-toggle").on("change",function(){const t=$($(this).data("list"));$(this).is(":checked")?t.removeClass("hidden"):t.addClass("hidden")}),$(document).on("click",".selected-customer",function(){const t=$(this).data("url");$("#selected-customer").addClass("hidden").removeClass("flex"),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios.get(t).then(o=>{const e=o.data;$("#numero_documento_customer").val(e.customer.numDocumento??""),$("#nit-receptor").val(e.customer.numDocumento??"").trigger("input"),$("#nombre_customer").val(e.customer.nombre),$("#nombre_comercial_customer").val(e.customer.nombreComercial),$("#actividad_economica_customer").val(e.customer.actividadEconomica),$("#complemento_customer").val(e.customer.complemento),$("#correo_customer").val(e.customer.correo),$("#telefono_customer").val(e.customer.telefono),$("#nrc_customer").val(e.customer.nrc),$("#select-tipos-documentos").html(e.select_tipos_documentos),$("#select-actividad-economica").html(e.select_actividad_economica),$("#select-departamentos").html(e.select_departamentos),$("#select-municipio").html(e.select_municipios),$("#select-pais").html(e.select_countries),$("#select-tipo-persona").html(e.select_tipo_persona)}).catch(o=>{console.error("Error al obtener el cliente:",o)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("click",".btn-selected-product",function(){const t=$(this).closest("form"),o=t.attr("action"),e=t.attr("method"),a=t.serialize();$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),$("#form-add-product").trigger("reset"),axios({method:e,url:o,data:a}).then(r=>{const s=r.data;if(s.success===!1){n("error","Error","Producto no encontrado");return}$("#product_id").val(s.product.id),$("#product_description").val(s.product.descripcion),s.product.has_stock?$("#count").prop("max",s.product.stockActual):$("#count").removeAttr("max");let l=s.product.precioSinTributos,i=s.product.precioUni;s.customer&&s.customer.special_price&&(l=s.product.special_price,i=s.product.special_price_with_iva);const u=s.dte!="01"?l:i;$("#product_price").val(u),$("#container-data-product").removeClass("hidden")}).catch(r=>{console.error("Error al obtener el producto:",r)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$("#count").on("input",function(){const t=$(this).val(),o=$("#product_price").val(),e=parseFloat($(this).prop("max")),a=parseFloat($("#descuento_total").val())||0,r=d(parseFloat(t)*parseFloat(o)-a,8);if(t>e){n("error","Error","La cantidad no puede ser mayor al stock disponible"),$(this).val(""),$("#total_item").val("");return}if(r<0){$("#descuento_total").val(0),$("#total_item").val(parseFloat(t)*d(parseFloat(o),8)),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(r),$("#descuento_total").prop("max",r)}),$("#descuento_total").on("input",function(){const t=parseFloat($(this).val())||0,o=parseFloat($("#descuento_total").prop("max"))||0;if(o===0){n("error","Error","Debes ingresar una cantidad y precio"),$(this).val("");return}if((t===""||t===0)&&$("#total_item").val($("#product_price").val()*$("#count").val()),t>o){n("error","Error","El descuento no puede ser mayor al total"),$(this).val(""),$("#total_item").val(d(o,8));return}const e=o-t;if(e<0){$("#total_item").val(0),n("error","Error","El descuento no puede ser mayor al total");return}$("#total_item").val(d(e,8))}),$("#btn-add-product").click(function(){const t=$(this).closest("form");let o=!1;const e=$("#count"),a=$("#error-"+e.attr("id")),r=$("#type-sale"),s=$("#error-"+r.attr("id")),l=$("#total_item"),i=$("#error-"+l.attr("id"));if(e.val().trim()===""?(e.focus().addClass("is-invalid"),a.css("display","flex"),o=!0):(e.removeClass("is-invalid"),a.css("display","none")),r.length>0&&(r.val().trim()===""?(r.next().find(".selected").addClass("is-invalid"),s.css("display","flex"),o=!0):(r.next().find(".selected").removeClass("is-invalid"),s.css("display","none"))),l.val().trim()===""?(l.focus().addClass("is-invalid"),i.css("display","flex"),o=!0):(l.removeClass("is-invalid"),i.css("display","none")),o){n("error","Error","Rellena los campos requeridos");return}$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"),axios({method:t.attr("method"),url:t.attr("action"),data:t.serialize()}).then(u=>{const m=u.data;console.log(m),m.success?($("#table-products-dte").html(m.table_products),$("#table-exportacion").html(m.table_exportacion),$("#container-data-product").addClass("hidden"),t.trigger("reset"),n("success","Agregado","Producto agregado correctamente"),m.monto_pendiente!==void 0&&$("#monto_total").val(d(m.monto_pendiente,2))):n("error","Error",m.message)}).catch(u=>{console.error("Error al agregar producto:",u)}).finally(()=>{$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")})}),$(document).on("change",".retener",function(){const t=$(this).data("action");var o="inactive";const e=$(this).data("type");$(this).is(":checked")?o="active":o="inactive",axios.get(t,{params:{value:o,type:e}}).then(function(a){$("#table-products-dte").html(a.data.table_products),a.data.monto_pendiente!==void 0&&$("#monto_total").val(d(a.data.monto_pendiente,2))}).catch(function(a){console.log(a)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#documento_asociado").on("Changed",function(){const t=$(this).val(),o=$("#container-data-documento-asociado"),e=$("#container-data-transporte"),a=$("#container-data-medico");switch(t){case"1":case"2":o.removeClass("hidden"),o.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required"),a.addClass("hidden"),a.find("input").removeAttr("required");break;case"3":o.addClass("hidden"),o.find("input").removeAttr("required"),a.removeClass("hidden"),a.find("input").attr("required",!0),e.addClass("hidden"),e.find("input").removeAttr("required");break;case"4":o.addClass("hidden"),o.find("input").removeAttr("required"),e.removeClass("hidden"),e.find("input").attr("required",!0),a.addClass("hidden"),a.find("input").removeAttr("required");break}}),$("#condicion_operacion").on("Changed",function(){const t=$(this).val();console.log(t),t==="1"&&($("#input-plazo").addClass("hidden"),$("#input-periodo").addClass("hidden")),t==="2"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden")),t==="3"&&($("#input-plazo").removeClass("hidden"),$("#input-periodo").removeClass("hidden"))}),$("#tipo_item_exportar").on("Changed",function(){const t=$(this).val(),o=$("#container-data-exportacion");t==="1"||t==="3"?o.removeClass("hidden"):(o.addClass("hidden"),o.find("input").val(""))});function c(t,o){return o=o||t.val(),o===""?(t.addClass("is-invalid"),!1):(t.removeClass("is-invalid"),!0)}$("#btn-add-forma-pago").on("click",function(){const t=$(this).data("action"),o=$("#condicion_operacion").val(),e=$("#forma_pago"),a=$("#monto_total"),r=$("#numero_documento"),s=$("#plazo"),l=$("#periodo");var i=!0;if(o==="1"&&(c(e.next().find(".selected"),e.val())||(i=!1),c(a)||(i=!1),c(r)||(i=!1)),o==="2"&&(c(a)||(i=!1),c(r)||(i=!1),c(s.next().find(".selected"),s.val())||(i=!1),c(l)||(i=!1)),o==="3"&&(c(e.next().find(".selected"),e.val())||(i=!1),c(a)||(i=!1),c(r)||(i=!1),c(s.next().find(".selected"),s.val())||(i=!1),c(l)||(i=!1)),!i){n("error","Error","Rellena los campos requeridos");return}i&&(axios.post(t,{forma_pago:e.val(),monto:a.val(),numero_documento:r.val(),plazo:s.val(),periodo:l.val(),_token:$("input[name='_token']").val()}).then(function(u){u.data.success?($("#table-formas-pago").html(u.data.table_data),$("#monto_total").val(u.data.monto_pendiente),n("success","Exito","Forma de pago agregada correctamente")):n("error","Error",u.data.message)}).catch(function(u){console.log(u)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden"))}),$("#monto_sujeto_retencion").on("input",function(){const t=$(this).val();$("#codigo_tributo").val()==="22"&&$("#iva_retenido").val(d(t*.01,2))}),$("#codigo_tributo").on("Changed",function(){if($(this).val()==="Retención IVA"){var o=$("#monto_sujeto_retencion").val();$("#iva_retenido").val(d(o*.01,2))}}),$(".new-item").on("click",function(){const t=$(this).data("action"),o=$(this).data("type");axios.get(t).then(function(e){if(e.data.success)o==="new-product"?($("#drawer-new-product").removeClass("-translate-x-full"),$("#overlay").removeClass("hidden"),$("body").addClass("overflow-hidden")):o==="selected-product"?($("#selected-product").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")):o==="other-contribution"&&($("#taxes-iva").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden"));else{n("warning","Advertencia","Para agregar items, primero debe ingresar los documentos relacionados");return}}).catch(function(e){console.log(e)})}),$(document).on("click",".submit-form",function(){const t=$(this).closest("form");console.log(t);let o=!0;if(t.find("[required]").each(function(){const e=$(this),a=$("#error-"+e.attr("id"));e.val().trim()?(e.removeClass("is-invalid"),a.css("display","none"),o=!0):(e.addClass("is-invalid"),a.css("display","flex"),o=!1),e.is("[select]")&&!e.val().trim()&&e.next().find(".selected").addClass("is-invalid")}),!o){n("error","Error","Rellena los campos requeridos");return}axios({method:t.attr("method"),url:t.attr("action"),data:t.serialize()}).then(function(e){const a=e.data;a.success?(n("success","Exito",a.message),t.trigger("reset"),$("#table-"+a.table).html(a.table_data),a.modal!==void 0?$("#"+a.modal).addClass("hidden").removeClass("flex"):a.drawer!==void 0&&($("#"+a.drawer).addClass("-translate-x-full"),$("#overlay").addClass("hidden")),a.monto_pendiente!==void 0&&$("#monto_total").val(d(a.monto_pendiente,2)),a.table_selected_product!==void 0&&$("#table-selected-product").html(a.table_selected_product),a.table_exportacion!==void 0&&$("#table-exportacion").html(a.table_exportacion),a.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(a.table_sujeto_excluido),a.select_data&&$("."+a.select).html(a.select_data),a.select_data_new&&$("."+a.select_new).html(a.select_data_new),a.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(a.total_iva_retenido_texto),a.total_discounts!==void 0&&$("#container-total-discount").html(a.total_discounts)):n("error","Error",a.message)}).catch(function(e){console.log(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".delete-discounts",function(){const t=$(this).data("action");axios.get(t).then(function(o){const e=o.data;e.success?($("#table-"+e.table).html(e.table_data),e.monto_pendiente!==void 0&&$("#monto_total").val(d(e.monto_pendiente,2)),e.total_discounts!==void 0&&$("#container-total-discount").html(e.total_discounts),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido)):n("error","Error",e.message)}).catch(function(o){console.log(o)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-delete",function(){const t=$(this).data("action");axios.get(t).then(function(o){const e=o.data;e.success?(n("success","Exito",e.message),e.table_data&&$("#table-"+e.table).html(e.table_data),e.table_data_2&&$("#table-"+e.table_2).html(e.table_data_2),e.total_iva_retenido_texto!==void 0&&$("#iva-retenido-letters").text(e.total_iva_retenido_texto),e.table_exportacion!==void 0&&$("#table-exportacion").html(e.table_exportacion),e.table_sujeto_excluido!==void 0&&$("#table-sujeto-excluido").html(e.table_sujeto_excluido),e.select_data&&$("."+e.select).html(e.select_data),e.monto_pendiente!==void 0&&$("#monto_total").val(d(e.monto_pendiente,2))):n("error","Error",e.message)}).catch(function(o){console.log(o)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#omitir_datos_receptor").on("change",function(){$(this).is(":checked")?($("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").val(""),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!0),$("#datos-receptor select, #datos-receptor input").prop("required",!1),$("#datos-receptor").addClass("hidden")):($("#datos-receptor input, #datos-receptor select").prop("required",!0),$("#datos-receptor input, #datos-receptor select, #datos-receptor textarea").prop("readonly",!1),$("#datos-receptor").removeClass("hidden"))}),$("#container-total-discount input").on("input",function(){$("#container-total-discount input").each(function(){parseFloat($(this).val())>100&&($(this).val(100),n("error","Error","El descuento no puede ser mayor al 100%"))})}),$(document).on("change","#seguro, #flete",function(){const t=$(this).data("url"),o=$(this).data("type"),e=$(this).val();axios.get(t,{params:{value:e,type:o}}).then(a=>{const r=a.data;r.success?(n("success","Éxito",r.message),r.monto_pendiente!==void 0&&$("#monto_total").val(d(r.monto_pendiente,2)),$("#table-exportacion").html(r.table_exportacion)):($("#flete").val(""),$("#seguro").val(""),n("error","Error",r.message))}).catch(a=>{console.error(a)})}),$(document).on("click",".btn-selected-document-electric",function(){const t=$(this).data("url"),o=$(this).data("cod");axios.get(t,{params:{codGeneracion:o}}).then(e=>{const a=e.data;a.success?(console.log(a),$("#table-"+a.table).html(a.table_data),$("#"+a.modal).addClass("hidden").removeClass("flex"),$("."+a.select).html(a.select_data),$("#overlay").addClass("hidden"),$("body").removeClass("overflow-hidden"),n("success","Exito",a.message)):n("error","Error",a.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-add-document-electric",function(){if($("#numero_documento_customer").val()===""){n("error","Error","Debes seleccionar un cliente antes de agregar un documento electrónico");return}$("#add-documento-electronico").removeClass("hidden").addClass("flex"),$("body").addClass("overflow-hidden")}),$(document).on("click",".btn-selected-document",function(){const t=$(this).data("cod"),o=$(this).data("url");axios.get(o,{params:{codGeneracion:t}}).then(e=>{const a=e.data;a.success?($("#container-data-document").removeClass("hidden"),$("#monto-documento").val(a.monto),$("#cod-generacion").val(t),$("#codigo-tributo-2").val()==="22"&&$("#iva-retenido-documento").val(d(a.monto*.01,2))):n("error","Error",a.message)}).catch(e=>{console.error(e)}).finally(function(){$("#loader").addClass("hidden"),$("body").removeClass("overflow-hidden")}),$("#loader").removeClass("hidden"),$("body").addClass("overflow-hidden")}),$("#sucursal_select").on("Changed",function(){const t=$(this).data("action"),o=$(this).val(),e=$(this).data("business-id");$("#datos-sucursal").addClass("hidden"),$.ajax({url:t,type:"GET",data:{sucursal_id:o,business_id:e},success:function(a){$("#punto_venta_select").html(a.html),$("#datos-sucursal #complemento_emisor").val(a.sucursal.complemento),$("#datos-sucursal #correo_emisor").val(a.sucursal.correo),$("#datos-sucursal #telefono_emisor").val(a.sucursal.telefono),$("#datos-sucursal").removeClass("hidden")},error:function(){console.error("Error al cambiar la sucursal")}})});function d(t,o=2){const e=Math.pow(10,o);return Math.round((t+Number.EPSILON)*e)/e}});
